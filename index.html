<!-- ✅ Полный index.html с поддержкой пузырей, заданий, фидбека, эффектов, и кастомизации -->
<html>
<head>
  <meta charset="UTF-8">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: transparent;
    }
    .task-box, .feedback-box {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 20px;
      font-size: 32px;
      text-align: center;
      z-index: 999;
    }
    .glass {
      background: linear-gradient(to bottom, rgba(255,255,255,0.25), rgba(255,255,255,0.05));
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.3);
      box-shadow: inset 0 1px 2px rgba(255,255,255,0.5), 0 4px 8px rgba(0,0,0,0.2);
    }
    .border {
      border: 2px solid;
    }
    .neon {
      box-shadow: 0 0 6px currentColor, 0 0 12px currentColor, 0 0 20px currentColor;
    }
    .bubble {
      position: absolute;
      border-radius: 50%;
      pointer-events: auto;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .sparkle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: white;
      border-radius: 50%;
      opacity: 0.8;
      animation: sparkle 0.5s ease-out forwards;
    }
    @keyframes sparkle {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }
  </style>
</head>
<body>
  <div id="task" class="task-box" style="display: none"></div>
  <div id="feedback" class="feedback-box" style="display: none"></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);

    const glassTask = urlParams.get("glassTask") === "true";
    const glassFeedback = urlParams.get("glassFeedback") === "true";
    const borderTask = urlParams.get("borderTask") === "true";
    const borderColorTask = urlParams.get("borderColorTask") || "#00ffff";
    const borderNeonTask = urlParams.get("borderNeonTask") === "true";
    const borderFeedback = urlParams.get("borderFeedback") === "true";
    const borderColorFeedback = urlParams.get("borderColorFeedback") || "#ff00ff";
    const borderNeonFeedback = urlParams.get("borderNeonFeedback") === "true";
    const borderRadius = urlParams.get("borderRadius") || "16";
    const noFeedbackText = urlParams.get("noFeedbackText") === "true";
    const bubbleImage = urlParams.get("bubbleImage");
    const feedbackImage = urlParams.get("feedbackImage");

    const tasks = (urlParams.get("tasks") || "Task 1\nTask 2\nTask 3").split("%0A");
    let currentTask = 0;

    const taskBox = document.getElementById("task");
    const feedbackBox = document.getElementById("feedback");

    if (glassTask) taskBox.classList.add("glass");
    if (glassFeedback) feedbackBox.classList.add("glass");

    if (borderTask) {
      taskBox.classList.add("border");
      taskBox.style.borderColor = borderColorTask;
      if (borderNeonTask) {
        taskBox.classList.add("neon");
        taskBox.style.color = borderColorTask;
      }
    }
    if (borderFeedback) {
      feedbackBox.classList.add("border");
      feedbackBox.style.borderColor = borderColorFeedback;
      if (borderNeonFeedback) {
        feedbackBox.classList.add("neon");
        feedbackBox.style.color = borderColorFeedback;
      }
    }
    taskBox.style.borderRadius = `${borderRadius}px`;
    feedbackBox.style.borderRadius = `${borderRadius}px`;

    function createSparkle(x, y) {
      const sparkle = document.createElement("div");
      sparkle.className = "sparkle";
      sparkle.style.left = `${x}px`;
      sparkle.style.top = `${y}px`;
      document.body.appendChild(sparkle);
      setTimeout(() => sparkle.remove(), 500);
    }

    function createBubble(x, y) {
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.style.width = "80px";
      bubble.style.height = "80px";
      bubble.style.left = `${x}px`;
      bubble.style.top = `${y}px`;
      if (bubbleImage) {
        bubble.style.background = `url('${decodeURIComponent(bubbleImage)}') center/cover`;
      } else {
        bubble.style.background = "radial-gradient(circle at 30% 30%, #aef, #36c)";
      }

      bubble.addEventListener("click", (e) => {
        bubble.remove();
        for (let i = 0; i < 10; i++) {
          createSparkle(e.clientX + Math.random()*20 - 10, e.clientY + Math.random()*20 - 10);
        }
        showTask();
      });
      document.body.appendChild(bubble);
    }

    function showTask() {
      if (currentTask >= tasks.length) {
        showFeedback();
        return;
      }
      taskBox.innerText = decodeURIComponent(tasks[currentTask]);
      taskBox.style.display = "block";
      currentTask++;

      taskBox.onclick = () => {
        taskBox.style.display = "none";
        createBubble(Math.random() * window.innerWidth * 0.8 + 50, Math.random() * window.innerHeight * 0.8 + 50);
      };
    }

    function showFeedback() {
      if (!noFeedbackText) {
        feedbackBox.innerText = decodeURIComponent(urlParams.get("feedback") || "Well done!");
      }
      feedbackBox.style.display = "block";
      if (feedbackImage) {
        feedbackBox.style.background = `url('${decodeURIComponent(feedbackImage)}') center/contain no-repeat`;
      }
      feedbackBox.onclick = (e) => {
        for (let i = 0; i < 15; i++) {
          createSparkle(e.clientX + Math.random()*30 - 15, e.clientY + Math.random()*30 - 15);
        }
      };
    }

    for (let i = 0; i < tasks.length; i++) {
      createBubble(Math.random() * window.innerWidth * 0.8 + 50, Math.random() * window.innerHeight * 0.8 + 50);
    }
  </script>
</body>
</html>
